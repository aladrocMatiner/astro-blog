---
import Layout from '../layouts/BaseLayout.astro';
import { isAdmin } from '../lib/admin';

const admin = isAdmin(Astro.cookies);
const next = Astro.url.searchParams.get('next') ?? '/drafts';
---
<Layout title="Admin · Astro Tech Blog">
  <section style="max-width:520px;">
    <h1>Modo administrador</h1>
    {admin ? (
      <>
        <p style="color:#cbd5f5;">Sesión activa. Ya puedes ver los borradores.</p>
        <div style="display:flex; gap:1rem; flex-wrap:wrap;">
          <a href={next} style="font-weight:600; color:#38bdf8;">Ir a borradores →</a>
          <form method="post" action="/api/admin/logout">
            <button type="submit" style="background:#1f2937; color:#fff; border:none; padding:0.5rem 1rem; border-radius:0.5rem;">
              Cerrar sesión
            </button>
          </form>
        </div>
      </>
    ) : (
      <>
        <p style="color:#cbd5f5;">
          Introduce el token de administración para habilitar la vista de borradores.
        </p>
        <form method="post" action="/api/admin/login" style="display:grid; gap:0.75rem;">
          <input type="hidden" name="next" value={next} />
          <label style="display:grid; gap:0.35rem;">
            <span style="font-weight:600;">Token</span>
            <input
              type="password"
              name="token"
              required
              style="padding:0.6rem 0.75rem; border-radius:0.5rem; border:1px solid #1f2937; background:#0f172a; color:#fff;"
            />
          </label>
          <button type="submit" style="background:#38bdf8; color:#0f172a; border:none; padding:0.6rem 1rem; border-radius:0.5rem; font-weight:600;">
            Activar modo administrador
          </button>
        </form>
      </>
    )}
  </section>
</Layout>
