---
import Layout from '../../layouts/BaseLayout.astro';

const posts = Object.entries(import.meta.glob('../../content/posts/*.md', { eager: true }))
  .map(([filePath, module]) => {
    const slug = filePath.replace('../../content/posts/', '').replace('.md', '');
    return { slug, module };
  });

const current = posts.find((item) => item.slug === Astro.params.slug);

if (!current) {
  throw new Error(`Post not found: ${Astro.params.slug}`);
}

const { module } = current;
const Content = module.default;
const { title, summary, publishDate, tags } = module.frontmatter;
---
<Layout title={`${title} · Astro Tech Blog`}>
  <article style="display:flex; flex-direction:column; gap:1rem;">
    <header>
      <p style="margin:0; color:#94a3b8;">
        {new Date(publishDate).toLocaleDateString('es-ES', {
          day: 'numeric',
          month: 'long',
          year: 'numeric'
        })}
        {' · '}
        <span class="tag">{tags.join(' · ')}</span>
      </p>
      <h1 style="margin:0;">{title}</h1>
      <p style="margin:0; color:#cbd5f5;">{summary}</p>
    </header>
    <section>
      <Content />
    </section>
  </article>
</Layout>
